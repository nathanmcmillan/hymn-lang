<!-- Any copyright is dedicated to the Public Domain.
     https://creativecommons.org/publicdomain/zero/1.0/ -->

<!DOCTYPE html>
<html>
  <head>
    <title>Hymn</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="index.css" />
  </head>
  <body>
    <script src="hymn.js"></script>
    <section id="top"><button onclick="run()">Run</button></section>
    <section id="play">
      <div id="code">
        <textarea id="source" autocorrect="off" autocomplete="off" autocapitalize="none" spellcheck="false"></textarea>
      </div>
      <p id="out"></p>
    </section>
    <script>
      const source = localStorage.getItem('source')
      if (source) {
        document.getElementById('source').value = source
      }
      let once = false
      function run() {
        if (once) {
          console.log('----------------------------------------')
        } else {
          once = true
        }
        const source = document.getElementById('source').value
        localStorage.setItem('source', source)
        const out = document.getElementById('out')
        out.textContent = ''
        const hymn = new Hymn()
        hymn.print = (text) => {
          out.textContent += text + '\r\n'
        }
        try {
          const error = hymnInterpret(hymn, source)
          if (error !== null) {
            out.textContent += error
          }
        } catch (exception) {
          out.textContent += exception
          console.error(exception)
        }
      }
    </script>
  </body>
</html>
